#!/bin/bash
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

if [ -f /etc/environment ]; then
    source /etc/environment
fi

PID_DIR="/tmp/run"
PID_FILE="$PID_DIR/hipache.pid"

LOG_DIR="/tmp/log"
LOG_FILE="$LOG_DIR/hipache.log"

CONFIG_FILE=$(realpath $DIR/../../app/config/hipache_${STAGE1_ENV:-dev}.json)

case $1 in 
    start)
        if [ ! -d $PID_DIR ]; then
            mkdir -p $PID_DIR
        fi

        if [ ! -d $LOG_DIR ]; then
            mkdir -p $LOG_DIR
        fi
        
        echo $$ > $PID_FILE
        exec 2>&1 hipache --config $CONFIG_FILE  &>> $LOG_FILE
        ;;
    stop)
        kill $(cat $PID_FILE)
        ;;
    *)
        echo "usage $0 {start|stop}"
esac
exit 0