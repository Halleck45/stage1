server {
        listen       127.0.0.1:8080;

        server_name  stage1;
        access_log   /var/log/nginx/access.log;
        error_log    /var/log/nginx/error.log;

        root /vagrant/web;
        index app.php;

#        auth_basic "Restricted";
#        auth_basic_user_file /etc/nginx/htpasswd;

        location / {
                try_files $uri $uri/ /app.php?$query_string;
        }

        location ~ /app\.php$ {
                fastcgi_pass unix:/var/run/php5-fpm.sock;
                fastcgi_index app.php;
                include /etc/nginx/fastcgi_params;
                fastcgi_param   SCRIPT_FILENAME    $document_root$fastcgi_script_name;
                fastcgi_param   SCRIPT_NAME        $fastcgi_script_name;
                fastcgi_param   SERVER_PORT        80;
        }
}

server {
        listen          127.0.0.1:9000;
        
        access_log      /var/log/nginx/docker.access.log;
        error_log       /var/log/nginx/docker.error.log;

        location / {
                proxy_pass http://unix:/var/run/docker.sock:/;
        }
}