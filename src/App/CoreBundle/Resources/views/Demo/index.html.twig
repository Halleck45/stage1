{% extends '::demo.html.twig' %}

{% block javascripts %}
<script type="text/javascript">

var demo_websocket_channel = '{{ channel }}';

demo_websocket_listen(demo_websocket_channel);

$('form#form-build').on('submit', function(event) {
    event.preventDefault();
    event.stopPropagation();

    try {
        var url = $(this).attr('action');
        var data = { 'project_id': $('#project_id option:selected').attr('value') };

        $(this).find('button').html('<i class="icon-refresh icon-spin"></i>').attr('disabled', true);

        $.post(url, data);
    } catch (e) {
        console.dir(e);
    }
});
</script>
{% endblock javascripts %}

{% block body %}
<form id="form-build" method="post" action="{{ path('app_core_demo_build') }}">
    <p class="lead">The demo allows you to build <strong>your very own container</strong>. It will be built with love just for you, and you will be given a <strong>unique url</strong> to access it.</p>
    <p class="lead">You can choose any of the following demo projects to build:</p>

    <select name="project_id" id="project_id" class="btn-large">
        {% for project in projects %}
        <option value="{{ project.id }}">{{ project.name }}</option>
        {% endfor %}
    </select>

    <br />

    <button class="btn btn-success btn-large" id="launch-build"><strong>Get my very own build</strong></button>

    <br /><br />

    <p><small>Please note all demo containers are deleted every night.</small></p>
</form>

<div id="build-meta">
</div>

<div id="build-steps">
</div>

<div id="build-url">
</div>

<hr />

{% include 'AppCoreBundle:Default:_marketing.html.twig' %}

<script type="text/mustache" id="tpl-url">{% verbatim %}
<p class="lead">Your build is ready!</p>
<a class="btn btn-large btn-success" href="{{ url }}"><strong>visit my build</strong></a>
{% endverbatim %}</script>

<script type="text/mustache" id="tpl-meta">{% verbatim %}
<h2>Building project {{project}}</h2>
{% endverbatim %}</script>

<script type="text/mustache" id="tpl-steps">{% verbatim %}
<ul id="steps">
    {{#steps}}
    <li class="pending" id="{{ id }}" data-toggle="tooltip" title="{{ tooltip }}" data-placement="right"><div class="icon-container"><i></i></div> {{ label }}</li>
    {{/steps}}
</ul>
{% endverbatim %}</script>

{% endblock body %}